- name: Test awscli installed
  command:
    cmd: which aws
  register: aws_location
  changed_when: aws_location.rc == 1
  failed_when: False

- when: aws_location.changed
  block:
    - name: Download awscliv2 installer.
      unarchive:
        src: https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip
        dest: "{{ executable_temp_dir | default('/tmp') }}"
        remote_src: yes
        creates: /tmp/aws
        mode: 0755

    - name: Run the installer.
      command:
      args:
        cmd: "{{ executable_temp_dir | default('/tmp') }}/aws/install"
        creates: /usr/local/bin/aws
      become: true
